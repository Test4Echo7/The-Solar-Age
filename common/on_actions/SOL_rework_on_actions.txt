on_actions = {
    on_declare_war = { #For tracking how many simultaneous wars EQS has. ROOT is the country who declared war. FROM is the target of the war.
        effect = {
            if = {
                limit = {
                    OR = {
                        ROOT = {
                            tag = EQS
                        }
                        FROM = {
                            tag = EQS
                        }
                    }
                }
                EQS = {
                    add_to_variable = { num_simultaneous_wars = 1 }
                }
            }
            if = {
                limit = {
                    ROOT = {
                        NOT = { tag = EQS }
                    }
                    FROM = {
                        tag = EQS
                    }
                }
                ROOT = {
                    set_country_flag = SOL_new_attacker
                }
            }
            if = {
                limit = {
                    FROM = {
                        NOT = { tag = EQS }
                    }
                    ROOT = {
                        tag = EQS
                    }
                }
                FROM = {
                    set_country_flag = SOL_new_defender
                }
            }
            if = {
                limit = {
                    ROOT = {
                        tag = EQS
                        is_EQS_SOL = yes
                    }
                    FROM = {
                        tag = GRD
                        has_country_flag = SOL_GRI_accepted
                    }
                }
                ROOT = {
                    country_event = {
                        id = solarreworked.515
                        days = 3
                    }
                }
                FROM = {
                    country_event = {
                        id = solarreworked.515
                        days = 3
                    }
                }
            }
            if = {
                limit = {
                    ROOT = {
                        tag = EQS
                        is_EQS_SOL = yes
                        has_opinion_modifier = EQS_GRI_spurned
                    }
                    FROM = {
                        tag = GRD
                    }
                }
                remove_opinion_modifier = {
                    target = GRD
                    modifier = EQS_GRI_spurned
                }
            }
            if = {
                limit = {
                    ROOT = {
                        tag = EQS
                        has_country_flag = SOL_demoralizing_propaganda
                    }
                }
                FROM = {
                    add_ideas = SOL_offensive_propaganda
                }
            }
            if = {
                limit = {
                    ROOT = {
                        OR = {
                            tag = EQS
                            tag = CHN
                        }
                    }
                    FROM = {
                        OR = {
                            tag = EQS
                            tag = CHN
                        }
                    }
                    EQS = {
                        NOT = {
                            OR = {
                                has_country_flag = EQS_tummies_be_rumbly
                                has_country_flag = SOL_harmonic_commanders_leave
                                has_country_flag = SOL_purge_finished
                            }
                        }
                    }
                }
                EQS = {
                    country_event = {
                        id = solarreworked.133
                        days = 180
                        random_days = 90
                    }
                    set_country_flag = EQS_tummies_be_rumbly
                }
            }
        }
    }
    on_war_relation_added = { #ROOT is attacker. FROM is defender
        effect = {
            log = "[GetDateText]: [ROOT.GetName]: on_war_relation_added solar_age"
            if = {
                limit = {
                    NOT = { has_global_flag = celestia_and_luna_fused }
                    OR = {
                        AND = {
                            ROOT = {
                                tag = CHN
                            }
                            FROM = {
                                tag = EQS
                                NOT = { is_EQS_SOL = yes }
                                NOT = { has_power_balance = { id = EQS_vestments_of_power_bop } }
                                NOT = { has_power_balance = { id = EQS_sanity_bop } }
                            }
                        }
                        AND = {
                            ROOT = {
                                tag = EQS
                                NOT = { is_EQS_SOL = yes }
                                NOT = { has_power_balance = { id = EQS_vestments_of_power_bop } }
                                NOT = { has_power_balance = { id = EQS_sanity_bop } }
                            }
                            FROM = {
                                tag = CHN
                            }
                        }
                    }
                }
                EQS = {
                    add_ideas = EQS_mental_decline
                    if = {
                        limit = { has_country_flag = EQS_sanity_bop_initialized }
                        set_power_balance = {
                            id = EQS_sanity_bop
                            left_side = EQS_angy
                            right_side = EQS_kalm
                        }
                    }
                    else = {
                        set_country_flag = EQS_sanity_bop_initialized
                        set_country_flag = EQS_great_war_experience
                        set_power_balance = {
                            id = EQS_sanity_bop
                            set_default = yes
                        }
                    }
                }
            }
            if = {
                limit = {
                    NOT = { has_global_flag = celestia_and_luna_fused }
                    ROOT = {
                        tag = NLR
                    }
                    FROM = {
                        tag = EQS
                        NOT = { is_EQS_SOL = yes }
                        NOT = { has_power_balance = { id = EQS_vestments_of_power_bop } }
                        NOT = { has_power_balance = { id = EQS_sanity_bop } }
                    }
                }
                FROM = {
                    add_ideas = EQS_mental_decline
                    if = {
                        limit = { has_country_flag = EQS_sanity_bop_initialized }
                        set_power_balance = {
                            id = EQS_sanity_bop
                            left_side = EQS_angy
                            right_side = EQS_kalm
                        }
                    }
                    else = {
                        set_country_flag = EQS_sanity_bop_initialized
                        set_country_flag = EQS_nmm_experience
                        set_power_balance = {
                            id = EQS_sanity_bop
                            left_side = EQS_angy
                            right_side = EQS_kalm
                            set_value = 0.65
                        }
                    }
                }
            }
            if = {
                limit = {
                    NOT = { has_global_flag = celestia_and_luna_fused }
                    ROOT = {
                        tag = EQS
                        NOT = { is_EQS_SOL = yes }
                        NOT = { has_power_balance = { id = EQS_vestments_of_power_bop } }
                        NOT = { has_power_balance = { id = EQS_sanity_bop } }
                    }
                    FROM = {
                        tag = BUF
                    }
                }
                ROOT = {
                    add_ideas = EQS_mental_decline
                    if = {
                        limit = { has_country_flag = EQS_sanity_bop_initialized }
                        set_power_balance = {
                            id = EQS_sanity_bop
                            left_side = EQS_angy
                            right_side = EQS_kalm
                        }
                    }
                    else = {
                        set_country_flag = EQS_sanity_bop_initialized
                        set_country_flag = EQS_why_you_so_mean
                        set_power_balance = {
                            id = EQS_sanity_bop
                            left_side = EQS_angy
                            right_side = EQS_kalm
                            set_value = 0.25
                        }
                    }
                }
            }
            if = { #For if anything other than the three specified countries
                limit = {
                    NOT = { has_global_flag = celestia_and_luna_fused }
                    OR = {
                        AND = {
                            ROOT = {
                                NOT = {
                                    tag = CHN
                                    tag = NLR
                                    tag = BUF
                                }
                            }
                            FROM = {
                                tag = EQS
                                NOT = { is_EQS_SOL = yes }
                                NOT = { has_power_balance = { id = EQS_vestments_of_power_bop } }
                                NOT = { has_power_balance = { id = EQS_sanity_bop } }
                            }
                        }
                        AND = {
                            ROOT = {
                                tag = EQS
                                NOT = { is_EQS_SOL = yes }
                                NOT = { has_power_balance = { id = EQS_vestments_of_power_bop } }
                                NOT = { has_power_balance = { id = EQS_sanity_bop } }
                            }
                            FROM = {
                                NOT = {
                                    tag = CHN
                                    tag = NLR
                                    tag = BUF
                                }
                            }
                        }
                    }
                }
                EQS = {
                    add_ideas = EQS_mental_decline
                    if = {
                        limit = { has_country_flag = EQS_sanity_bop_initialized }
                        set_power_balance = {
                            id = EQS_sanity_bop
                            left_side = EQS_angy
                            right_side = EQS_kalm
                        }
                    }
                    else = {
                        set_country_flag = EQS_sanity_bop_initialized
                        set_country_flag = EQS_great_war_experience
                        set_power_balance = {
                            id = EQS_sanity_bop
                            left_side = EQS_angy
                            right_side = EQS_kalm
                            set_value = 0.75
                        }
                    }
                }
                if = {
                    limit = {
                        ROOT = {
                            OR = {
                                tag = CHN
                                tag = NLR
                            }
                        }
                        FROM = {
                            tag = EQS
                            has_power_balance = { id = EQS_sanity_bop }
                            NOT = { has_idea = EQS_mental_decline }
                        }
                    }
                    FROM = {
                        add_ideas = EQS_mental_decline
                    }
                }
                if = {
                    limit = {
                        OR = {
                            ROOT = {
                                tag = EQS
                                has_idea = SOL_harmonic_resistance_idea
                            }
                            FROM = {
                                tag = EQS
                                has_idea = SOL_harmonic_resistance_idea
                            }
                        }
                        NOT = { has_country_flag = SOL_harmonic_resistance_stymying }
                    }
                    country_event = {
                        id = solarreworked.537
                        days = 7
                        random_days = 14
                    }
                    set_country_flag = SOL_harmonic_resistance_stymying
                }
                if = {
                    limit = {
                        ROOT = {
                            tag = EQS
                            NOT = { has_country_flag = EQS_sanity_warning }
                        }
                        FROM = {
                            tag = EQS
                            NOT = { has_country_flag = EQS_sanity_warning }
                        }
                    }
                    EQS = {
                        set_country_flag = EQS_sanity_warning
                        country_event = {
                            id = solarreworked.531
                            days = 2
                        }
                    }
                }
            }
        }
    }
    on_peace = { #THIS is country no longer at war
        effect = {
            log = "[GetDateText]: [ROOT.GetName]: on_peace solar_age"
            if = {
                limit = {
                    tag = EQS
                    has_power_balance = { id = EQS_sanity_bop }
                }
                EQS = {
                    remove_ideas = EQS_mental_decline
                }
            }
            if = {
                limit = {
                    THIS = {
                        OR = {
                            has_country_flag = SOL_new_attacker
                            has_country_flag = SOL_new_defender
                        }
                    }
                }
                THIS = {
                    if = {
                        limit = { has_country_flag = SOL_new_attacker }
                        clr_country_flag = SOL_new_attacker
                    }
                    if = {
                        limit = { has_country_flag = SOL_new_defender }
                        clr_country_flag = SOL_new_defender
                    }
                }
                EQS = { #This should work how it's intended. Whenever a country that is in its own war with EQS, either because it declared on them or was declared on by them is peaced out, it reduces the number of simultaneous wars by 1. Should only fire in those scenarios
                    subtract_from_variable = { num_simultaneous_wars = 1 }
                }
            }
            if = {
                limit = {
                    EQS = { has_country_flag = SOL_demoralizing_propaganda }
                    THIS = { has_idea = SOL_offensive_propaganda }
                }
                THIS = {
                    remove_ideas = SOL_offensive_propaganda
                }
            }
        }
    }
    on_capitulation = {
        effect = {
            if = { #Check if RCT had River Swirl as leader
                limit = {
                    ROOT = {
                        OR = {
                            tag = RCT
                            tag = RIV
                        }
                        has_country_leader = { character = RCT_river_swirl ruling_only = yes }
                    }
                    FROM = {
                        tag = EQS
                        is_EQS_SOL = yes
                    }
                }
                log = "[GetDateText]: [ROOT.GetName]: on_capitulation solar_age"
                FROM = { set_country_flag = SOL_RCT_had_river_leader }
            }
            if = {
                limit = {
                    ROOT = {
                        tag = CES
                        has_country_leader = { character = CES_good_word ruling_only = yes }
                        NOT = {
                            has_country_flag = CES_vindictive_god_ending
                            has_country_flag = CES_faced_divine_judgement
                            has_idea = CES_solarist_partially_pleased_daybreaker
                        }
                    }
                    FROM = {
                        tag = EQS
                        has_completed_focus = SOL_god_empress
                    }
                }
                FROM = {
                    country_event = {
                        id = solarreworked.465
                        days = 7
                        random_days = 7
                    }
                }
            }
        }
    }
    on_state_control_changed = { #Root is new controller. From is old controller. FROM.FROM is the state
        effect = {
            log = "[GetDateText]: [ROOT.GetName]: on_state_control_changed solar_age"
            if = {
                limit = {
                    FROM.FROM = {
                        is_core_of = EQS
                    }
                    FROM = {
                        tag = EQS
                        has_power_balance = {
                            id = EQS_sanity_bop
                        }
                    }
                }
                FROM = {
                    add_power_balance_value = {
                        id = EQS_sanity_bop
                        value = -0.005
                    }
                }
            }
            if = {
                limit = {
                    FROM.FROM = {
                        is_core_of = EQS
                    }
                    ROOT = {
                        tag = EQS
                        has_power_balance = {
                            id = EQS_sanity_bop
                        }
                    }
                }
                ROOT = {
                    add_power_balance_value = {
                        id = EQS_sanity_bop
                        value = 0.005
                    }
                }
            }
            if = {
                limit = {
                    FROM.FROM = {
                        state = 3
                    }
                    FROM = {
                        tag = EQS
                        has_country_flag = SOL_holding_nmm
                    }
                    ROOT = {
                        tag = BAT
                    }
                }
                ROOT = {
                    country_event = solarreworked.511
                }
            }
            if = {
                limit = {
                    FROM.FROM = {
                        has_state_flag = EQS_guaranteed_bat_state
                        NOT = { has_dynamic_modifier = { modifier = SOL_thestral_resistance } }
                    }
                    ROOT = {
                        tag = EQS
                        has_country_flag = SOL_bat_resistance_add_flag
                    }
                }
                FROM.FROM = {
                    add_dynamic_modifier = { modifier = SOL_thestral_resistance }
                }
            }
            if = {
                limit = {
                    FROM.FROM = {
                        has_state_flag = EQS_guaranteed_bat_state
                        NOT = { has_dynamic_modifier = { modifier = SOL_thestral_resistance } }
                    }
                    FROM = {
                        tag = EQS
                        has_country_flag = SOL_bat_resistance_add_flag
                    }
                }
                FROM.FROM = {
                    remove_dynamic_modifier = { modifier = SOL_thestral_resistance }
                }
            }
        }
    }
    #ROOT = nation being puppeted, FROM = overlord
    on_puppet = {
        effect = {
            log = "[GetDateText]: [ROOT.GetName]: on_puppet solar_age"
            if = {
                limit = {
                    is_subject_of = event_target:solar_empire
                    NOT = {
                        original_tag = GRD
                        has_country_flag = is_solar_puppet
                    }
                    OR = {
                        original_tag = PLB
                        original_tag = GRF
                        original_tag = PNG
                        original_tag = STL
                        original_tag = BUF
                        original_tag = DRG
                        original_tag = GFF
                        original_tag = OLE
                        original_tag = BAL
                        original_tag = CES
                        original_tag = JUN
                        original_tag = SCS
                        original_tag = STG
                        original_tag = JAK
                        original_tag = CHN
                        original_tag = YAK
                        original_tag = AST
                        original_tag = HLR
                        original_tag = ZES
                        original_tag = HIP
                        original_tag = CTH
                        original_tag = CTL
                        original_tag = ABY
                        original_tag = ZOO
                        original_tag = MAZ
                        original_tag = STM
                        original_tag = GAR
                        original_tag = ROA
                        original_tag = ZAR
                        original_tag = SDL
                        original_tag = YMN
                        original_tag = MGY
                        original_tag = KAR
                        original_tag = REE
                        original_tag = MTA
                        original_tag = OSQ
                        original_tag = RIV
                        original_tag = KIR
                        original_tag = NVA
                        original_tag = KHM
                        original_tag = KXN
                        original_tag = DMT
                        original_tag = MTO
                    }
                }
                apply_SOL_cosmetic_tags_on_puppet = yes
            }
        }
    }
    #ROOT = nation being released, FROM = overlord
    on_release_as_puppet = {
        effect = {
            log = "[GetDateText]: [ROOT.GetName]: on_release_as_puppet solar_age"
            if = {
                limit = {
                    is_subject_of = event_target:solar_empire
                    NOT = {
                        original_tag = GRD
                        has_country_flag = is_solar_puppet
                    }
                    OR = {
                        original_tag = PLB
                        original_tag = GRF
                        original_tag = PNG
                        original_tag = STL
                        original_tag = BUF
                        original_tag = DRG
                        original_tag = GFF
                        original_tag = OLE
                        original_tag = BAL
                        original_tag = CES
                        original_tag = JUN
                        original_tag = SCS
                        original_tag = STG
                        original_tag = JAK
                        original_tag = CHN
                        original_tag = YAK
                        original_tag = AST
                        original_tag = HLR
                        original_tag = ZES
                        original_tag = HIP
                        original_tag = CTH
                        original_tag = CTL
                        original_tag = ABY
                        original_tag = ZOO
                        original_tag = MAZ
                        original_tag = STM
                        original_tag = GAR
                        original_tag = ROA
                        original_tag = ZAR
                        original_tag = SDL
                        original_tag = YMN
                        original_tag = MGY
                        original_tag = KAR
                        original_tag = REE
                        original_tag = MTA
                        original_tag = OSQ
                        original_tag = RIV
                        original_tag = KIR
                        original_tag = NVA
                        original_tag = KHM
                        original_tag = KXN
                        original_tag = DMT
                        original_tag = MTO
                    }
                }
                apply_SOL_cosmetic_tags_on_puppet = yes
            }
        }
    }
    #on_monthly = {
    #    effect = {
    #        log = "[GetDateText]: [ROOT.GetName]: on_monthly solar_age"
    #        if = {
    #            limit = {
    #                ROOT = {
    #                    is_ai = no
    #                }
    #                EQS = {
    #                    has_country_flag = EQS_player_started_as_EQS
    #                }
    #                NOT = {
    #                    any_other_country = { is_ai = no }
    #                }
    #            }
    #            #country_event = solarreworked.420 #You nasty, John Paradox, you
    #        }
    #    }
    #}
    #ROOT is the winner, FROM is the loser
    on_peaceconference_ended = {
        effect = {
            log = "[GetDateText]: [ROOT.GetName]: on_peaceconference_ended solar_age"
            if = {
                limit = {
                    ROOT = {
                        tag = EQS
                        is_EQS_SOL = yes
                    }
                    FROM = {
                        tag = NLR
                    }
                }
                ROOT = {
                    country_event = {
                        id = solarreworked.258
                        days = 1
                    }
                }
            }
            if = {
                limit = {
                    ROOT = {
                        tag = EQS
                        is_EQS_SOL = yes
                    }
                    FROM = {
                        tag = CES
                        has_character = CES_daring_do
                    }
                }
                ROOT = {
                    country_event = {
                        id = solarreworked.477
                        days = 14
                        random_days = 7
                    }
                }
            }
            if = {
                limit = {
                    ROOT = {
                        tag = EQS
                        is_EQS_SOL = yes
                    }
                    FROM = {
                        tag = STG
                    }
                }
                ROOT = {
                    country_event = {
                        id = solarreworked.472
                        days = 30
                        random_days = 15
                    }
                }
            }
            if = {
                limit = {
                    ROOT = {
                        tag = EQS
                        is_EQS_SOL = yes
                    }
                    FROM = {
                        tag = event_target:equestria
                        has_country_flag = SOL_hosting_M6
                    }
                }
                ROOT = {
                    country_event = {
                        id = solarreworked.532
                        days = 7
                        random_days = 3
                    }
                }
            }
        }
    }
    on_monthly_EQS = {
        effect = {
            log = "[GetDateText]: [ROOT.GetName] on_monthly_EQS solar_age"
            if = {
                limit = {
                    OR = {
                        has_completed_focus = SOL_Imperial_Investigative_Service
                        has_completed_focus = SOL_solaris_speculatores
                    }
                    OR = {
                        NOT = { has_dlc = "La Resistance" }
                        AND = {
                            has_dlc = "La Resistance"
                            has_intelligence_agency = yes
                        }
                    }
                    NOT = { has_global_flag = SOL_attempted_enemy_assassinations }
                }
                every_possible_country = {
                    limit = {
                        has_character = EQS_princess_luna
                        NOT = { tag = HIP }
                        NOT = { tag = RCT }
                        NOT = { tag = MGY }
                        NOT = { tag = NLR }
                        NOT = { tag = EQS }
                        NOT = { tag = event_target:equestria }
                        exists = yes
                    }
                    country_event = {
                        id = solarreworked.163
                        random_days = 14
                    }
                }
                set_global_flag = SOL_attempted_enemy_assassinations
            }
            if = {
                limit = {
                    has_completed_focus = SOL_Imperium_Solis
                    has_war_with = NLR
                    NOT = { has_country_flag = SOL_empress_fight }
                    NLR = {
                        exists = yes
                        surrender_progress > 0.3
                    }
                }
                country_event = solarreworked.259
            }
            if = {
                limit = {
                    has_completed_focus = SOL_solaris_inquisitionis
                    has_global_flag = SOL_twilight_converted
                    NOT = { has_country_flag = SOL_god_empress_flavor }
                }
                country_event = {
                    id = solarreworked.315
                    days = 60
                    random_days = 90
                }
                set_country_flag = SOL_god_empress_flavor
            }
        }
    }
    on_weekly_EQS = { #To clean up borders a bit
        effect = {
            log = "[GetDateText]: [ROOT.GetName]: on_weekly_EQS solar_age"
            if = {
                limit = {
                    has_war = yes
                }
                EQS_update_lost_soldier_corpses = yes
            }
            #if = {
            #    limit = {
            #        is_ai = no
            #        NOT = { has_country_flag = EQS_player_started_as_EQS }
            #        NOT = {
            #            any_other_country = { is_ai = no } #Basically the only way to check if there's a multiplayer game, since PDX decided not to have a is_multiplayer or some such trigger
            #        }
            #    }
            #    set_country_flag = EQS_player_started_as_EQS
            #}
            if = {
                limit = {
                    NOT = { has_country_flag = SOL_puppets_left }
                    has_war = no
                    is_EQS_SOL = yes
                }
                country_event = {
                    id = solarreworked.502
                    days = 21
                    random_days = 21
                }
                set_country_flag = SOL_puppets_left
            }
            if = {
                limit = {
                    date > 1021.12.31
                    EQS = {
                        has_completed_focus = SOL_rouse_godhood
                        CRY_flurry_heart = {
                            NOT = { is_corps_commander = yes }
                            is_advisor = yes
                        }
                        NOT = { has_country_flag = SOL_flurry_field_position }
                    }
                }
                set_country_flag = SOL_flurry_field_position
                country_event = {
                    id = solarreworked.501
                    days = 30
                    random_days = 120
                }
            }
            if = {
                limit = {
                    owns_state = 1208
                    MGY = { is_subject_of = ROOT }
                    is_EQS_SOL = yes
                }
                MGY = {
                    transfer_state = 1208
                    add_state_core = 1208
                }
            }
        }
    }
    on_startup = { #Don't want to touch MGY files. But seriously, EaW, why no Somnambula advisor trait despite having her recruited?
        effect = {
            every_possible_country = {
                limit = { has_character = MGY_somnambula }
                MGY_somnambula = {
                    add_advisor_role = {
                        advisor = {
                            slot = political_advisor
                            idea_token = somnambula
                            traits = { pillar_of_hope_solar }
                        }
                    }
                }
            }
            every_possible_country = {
                limit = { has_character = EQS_SOL_aurora_shinespark }
                random_list = {
                    1 = {
                        EQS_SOL_aurora_shinespark = {
                            set_portraits = {
                                army = {
                                    large = "gfx/leaders/EQS/Aurora_Shinespark_easter_egg.tga"
                                    small = "gfx/interface/ideas/advisors/EQS/EQS_aurora_shinespark_easter_egg.tga"
                                }
                            }
                            remove_unit_leader_role = yes
                            add_corps_commander_role = {
                                traits = { harsh_leader pony_race_trait promising_general }
                                skill = 2
                                attack_skill = 3
                                defense_skill = 1
                                planning_skill = 1
                                logistics_skill = 2
                                desc = EQS_SOL_aurora_shinespark_prototype_desc
                                visible = {
                                    is_EQS_SOL = yes
                                    has_country_flag = SOL_inquisitor_generals
                                }
                            }
                        }
                    }
                    99 = {

                    }
                }
            }
        }
    }
}
